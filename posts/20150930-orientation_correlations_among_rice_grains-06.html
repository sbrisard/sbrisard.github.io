<!DOCTYPE html>
<html lang="en">
  <head>
      <title>Sébastien Brisard's blog - Orientation correlations among rice grains, part 6: segmentation</title>
    <link rel="stylesheet" href="https://sbrisard.github.io/theme/css/main.css" />
    <meta charset="utf-8" />
    <link href="https://sbrisard.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="Sébastien Brisard's blog Full RSS Feed" />





  </head>

  <body id="index" class="home">
    <header id="siteheader">
      <img id="sitebanner" src="https://sbrisard.github.io/theme/images/banner.jpg"/>
      <div id="sitename"><a href="https://sbrisard.github.io/">Sébastien Brisard's blog <strong></strong></a></div>
      <nav id="sitemenu">
	<ul>
          <li><a href="/pages/about.html" title="About this blog">About this blog</a></li>
          <li><a href="https://cv.archives-ouvertes.fr/sbrisard" title="About me">About me</a></li>
          <li><a href="/archives.html" title="Archives">Archives</a></li>
          <li><a href="https://github.com/sbrisard" title="GitHub">GitHub</a></li>
          <li><a href="https://twitter.com/SebBrisard" title="Twitter">Twitter</a></li>
          <li><a href="feed.xml" title="RSS">RSS</a></li>
	</ul>
      </nav>
    </header>
<section id="content" class="body">
  <header>
    <h1 class="entry-title">
      <a href="https://sbrisard.github.io/posts/20150930-orientation_correlations_among_rice_grains-06.html" rel="bookmark"
         title="Permalink to Orientation correlations among rice grains, part 6: segmentation">Orientation correlations among rice grains, part 6: segmentation</a></h1>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2015-09-30T00:00:00+02:00">
      Published 30 September 2015
    </time>
    <address class="vcard author">
      by           <a class="url fn" href="https://sbrisard.github.io/author/sebastien-brisard.html">Sébastien Brisard</a>
    </address>
    <div class="category">
        Category: <a href="https://sbrisard.github.io/category/image-analysis.html">Image analysis</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>In the <a href="https://sbrisard.github.io/posts/20150709-orientation_correlations_among_rice_grains-05.html">previous
instalment</a>
of this series, I showed that a convincing binary image could be produced from
the gray level 3D reconstruction of the assembly of rice grains, using Otsu's
threshold. However, I intend to carry out statistical analyses of the <em>grains</em>
themselves in the subsequent instalments. Therefore, instead of a binary image
of the rice grains, what is really needed is a <em>labelled</em> image, where all
voxels which are thought to belong to the same rice grain are tagged with the
same label.  This is called <em>segmentation</em>, which is the topic of the present
post. I will first show that the most basic segmentation technique (namely,
<em>detecting connected components</em> in the image) fails in the present case. This
calls for a more elaborate strategy, based on the widely popular
<a href="https://en.wikipedia.org/wiki/Watershed_%28image_processing%29">watershed</a>
method. However, <a href="#watershed_blind">blind application</a> of the standard watershed
strategy leads to over-segmentation. This post will therefore close on a
<a href="#watershed-directional_erosion">problem-dependent strategy</a> better suited to
the present case.</p>
<p>Before we start, let me mention a book-keeping issue. Up to the previous post,
2D slices of the 3D image were stored in separate <code>*.tif</code> files, which is rather
tedious to load and solve. From now on, I will store all analyses in a <code>*.hdf5</code>
file. I am by no means an expert on this great file format (see
<a href="https://www.hdfgroup.org/HDF5/">website</a>), but what I like about it is</p>
<ol>
<li>it is language-agnostic,</li>
<li>it is platform- (and architecture-) independent: no indianness problem,</li>
<li>several arrays can be stored in the <em>same</em> file,</li>
<li>comments can be attached to a dataset.</li>
</ol>
<p>The following code snippet
(<a href="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/tif2hdf5.py">download</a>)
converts the binary <code>*.tif</code> images into a single <code>*.hdf5</code> file. It uses the
<a href="http://www.h5py.org/">h5py</a> library; <a href="http://www.pytables.org/">PyTables</a> is
another option.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">skimage.io</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">root</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;F:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;sebastien&#39;</span><span class="p">,</span> <span class="s1">&#39;experimental_data&#39;</span><span class="p">,</span> <span class="s1">&#39;navier&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;riz&#39;</span><span class="p">)</span>
    <span class="n">input_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;bin_4x4x4-otsu&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;rice-bin_4x4x4-otsu_126-</span><span class="si">{0:03d}</span><span class="s1">.tif&#39;</span><span class="p">)</span>
    <span class="n">output_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;rice-bin_4x4x4.hdf5&#39;</span><span class="p">)</span>
    <span class="n">num_slices</span> <span class="o">=</span> <span class="mi">172</span>

    <span class="n">binary</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_slices</span><span class="p">):</span>
        <span class="n">slc</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">input_name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">binary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_slices</span><span class="p">,)</span><span class="o">+</span><span class="n">slc</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">slc</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">binary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">slc</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">dset</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">binary</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s1">&#39;Otsu threshold 126&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Now, on to segmentation!</p>
<h2>Detecting connected components</h2>
<p>This is probably the most simple segmentation technique. In this approach, a
<em>feature</em> is defined as a connected component of the image. Let's be honnest: it
rarely works on real-life images, because most of the times, distinct objects
usually touch, and therefore appear as connected. <a href="#fig01">Fig. 1</a> shows that
our 3D image is no exception to this rule!
<a name="fig01"></a>
<img alt="Connected components of the assembly of rice grains" class="figure" src="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/binary.png"></p>
<figcaption>Figure 1: A slice of the binary image. Clearly, some rice grains are
connected. In other words, detecting connected components is not a suitable
strategy for the segmentation of rice grains.</figcaption>
<p>So, we should expect no miracle from this approach. However, it is interesting
to show how easy it is to identify the connected components of an image, using
the <code>scipy.ndimage</code> module
(<a href="http://docs.scipy.org/doc/scipy/reference/ndimage.html">documentation</a>), in
particular the <code>scipy.ndimage.label</code> function
(<a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.measurements.label.html#scipy-ndimage-measurements-label">documentation</a>).
Note the use of <code>np.ones((3, 3, 3))</code> as a structuring element, meaning
26-connectivity.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span> <span class="k">as</span> <span class="n">ndi</span>
<span class="kn">from</span> <span class="nn">skimage.io</span> <span class="kn">import</span> <span class="n">imsave</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">root</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;F:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;sebastien&#39;</span><span class="p">,</span> <span class="s1">&#39;experimental_data&#39;</span><span class="p">,</span> <span class="s1">&#39;navier&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;riz&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;rice-bin_4x4x4.hdf5&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selecting markers from distance local maxima...&#39;</span><span class="p">)</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">num_labels</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span>
                                   <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    ... found </span><span class="si">{}</span><span class="s1"> connected components&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_labels</span><span class="p">))</span>

    <span class="n">index</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">20150928</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">imsave</span><span class="p">(</span><span class="s1">&#39;connected_components.png&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>
</code></pre></div>

<p>The above code snippet
(<a href="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/connected_components.py">download</a>)
detects 117 connected components, and produces the following colored image (one
color per label), see <a href="#fig02">Fig. 2</a>. Unsurprisingly, all grains are connected
on this slice, and we have produced a very poor segmentation indeed!
<a name="fig02"></a>
<img alt="Connected components" class="figure" src="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/connected_components.png"></p>
<figcaption>Figure&nbsp;2:&nbsp;All rice grains of the slice shown on <a href="#fig01">Fig.&nbsp;1</a> are connected!</figcaption>
<p>To close this section, it should be noted that the last lines of the above
script produce a color image where each label receives a random color. Standard
color maps are indeed ill-suited to visualization of labelled images. Indeed,
these color maps are most of the times smooth, which means that close labels are
barely distinguishable. This is undesirable, since neighbouring features usually
get close labels.</p>
<p>Also note the use of <a href="http://docs.scipy.org/doc/numpy/reference/arrays.indexing.html#indexing">advanced
indexing</a>
of the Numpy arrays (<code>colors[labels[index]]</code>)... Python and Numpy rock!</p>
<p><a name="watershed_blind"></a></p>
<h2>Watershed segmentation, blind application</h2>
<p>The watershed segmentation is a very popular technique to segment overlapping
objects. Describing this technique is out of the scope of this post. Suffice it
to say that watershed segmentation is a three-step process</p>
<ol>
<li>compute the <em>topography</em> of the image (usually, a gradient map or the
   opposite of the distance map to the background),</li>
<li>select seeds,</li>
<li>grow connected region from seeds.</li>
</ol>
<p>The second step is the critical one, since each seed results in exactly one
feature in the segmented image. Too many seeds result in an oversegmented image
(grains are split), while too little seeds result in an under-segmented image
(grains are merged).</p>
<p>While tedious, manual seeding is probably your best choice (as argued by
<a href="http://emmanuelle.github.io/a-tutorial-on-segmentation.html#semi-supervised-approach-segmenting-the-image-from-user-defined-markers">Emmanuelle
Gouillart</a>).
There are about 2000 rice grains in the 3D image we are working with, so this
semi-supervised approach is unfortunately not an option for us.</p>
<p>The standard unsupervised seeding technique consists in selecting the local
maxima of the map of the distance to the background. The opposite of the
distance map is then used as topography. This is essentially what the script
below does
(<a href="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/watershed-distance_local_max.py">download</a>).
It draws heavily on the example from the
<a href="http://scikit-image.org/docs/dev/api/skimage.morphology.html#watershed">scikit-image</a>
documentation.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Watershed using local maxima of the distance map as seeds.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span> <span class="k">as</span> <span class="n">ndi</span>
<span class="kn">from</span> <span class="nn">skimage.feature</span> <span class="kn">import</span> <span class="n">peak_local_max</span>
<span class="kn">from</span> <span class="nn">skimage.io</span> <span class="kn">import</span> <span class="n">imread</span><span class="p">,</span> <span class="n">imsave</span><span class="p">,</span> <span class="n">imshow</span>
<span class="kn">from</span> <span class="nn">skimage.morphology</span> <span class="kn">import</span> <span class="n">watershed</span>

<span class="k">def</span> <span class="nf">markers_from_distance_local_max</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">root</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;F:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;sebastien&#39;</span><span class="p">,</span> <span class="s1">&#39;experimental_data&#39;</span><span class="p">,</span> <span class="s1">&#39;navier&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;riz&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;rice-bin_4x4x4.hdf5&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing distance transform&#39;</span><span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selecting markers from distance local maxima...&#39;</span><span class="p">)</span>
    <span class="n">local_maxi</span> <span class="o">=</span> <span class="n">peak_local_max</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">binary</span><span class="p">,</span>
                                <span class="n">min_distance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">markers</span><span class="p">,</span> <span class="n">num_seeds</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">local_maxi</span><span class="p">,</span>
                                   <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    ... found </span><span class="si">{}</span><span class="s1"> seeds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_seeds</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing watershed transform&#39;</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">watershed</span><span class="p">(</span><span class="o">-</span><span class="n">distance</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">binary</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">20150929</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">imsave</span><span class="p">(</span><span class="s1">&#39;distance.png&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">/</span><span class="n">distance</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">imsave</span><span class="p">(</span><span class="s1">&#39;watershed-distance_local_max.png&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>
</code></pre></div>

<p>The result of this operation is shown on <a href="#fig03">Fig. 3</a>, where
over-segmentation is observed. The reason for this is very simple, and typical
of elongated objects: there are several local maxima of the distance map in each
grain (see <a href="#fig04">Fig. 4</a>), resulting in too many seeds.
<a name="fig03"></a>
<img alt="Watershed
segmentation" class="figure" src="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/watershed-distance_local_max.png"></p>
<figcaption>Figure 3: The result of watershed segmentation using local maxima of
the map of the distance to the background as seeds. Clearly, over-segmentation
occurs, which is typical with elongated objects.</figcaption>
<p><a name="fig04"></a>
<img alt="Distance map" class="figure" src="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/distance.png"></p>
<figcaption>Figure 4: The map of the distance to the background. There are
several local maxima in each grain.</figcaption>
<p>One possible response would be to use so-called <em>vertical filters</em> (<a href="https://doi.org/10.5566/ias.v27.p23-28">Tariel et
al., 2008</a>). I used here a more
intuitive approach by providing a <code>min_distance</code> parameter to the
<a href="http://scikit-image.org/">scikit-image</a> <code>peak_local_max</code>
(<a href="http://scikit-image.org/docs/stable/api/skimage.feature.html#peak-local-max">documentation</a>)
function. The selected value (namely, 10 px) corresponds to the typical
equatorial radius of the rice grains (as manually measured on the binary
images). This indeed reduces over-segmentation, but does not solve the problem
completely.</p>
<p>In the next section, we will see how a problem dependent solution can be
proposed.</p>
<p><a name="watershed-directional_erosion"></a></p>
<h2>Watershed segmentation with directional erosion</h2>
<p>In the <a href="#watershed_blind">previous section</a>, over-segmentation occured because
of the anisotropy of the objects. In other words, had the grains been nearly
spherical, then we would have produced a very convincing segmentation with the
above method.</p>
<p>The grains are elongated: this is a fact. Instead of ignoring it (at the cost of
over-segmentation), we should take this important piece of information into
account in the seeding process. In the present section I propose to erode the
binary image with elongated structuring elements.  Only those grains which have
roughly the same orientation as the structuring element will remain. If we vary
the orientation of the structuring element, we should be able to seed each
grain.</p>
<p>The proposed procedure is summarized below.</p>
<ol>
<li>Generate a set of orientations: we will use the vertices of an icosahedron,
   which give 20 orientations, uniformly distributed on the unit sphere.</li>
<li>Generate the corresponding ellipsoidal structuring elements, using the class
   <code>Spheroid</code>, defined
   <a href="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/spheroid.py">here</a>.
   I will not comment this module in the present post (I might make it the topic
   of a future post!). Suffice it to say that the aspect ratio of the
   structuring element is close to that of the actual rice grains. The
   structuring element should be neither too small, nor too large. I (manually)
   selected an equatorial radius of 3.5 px, and a polar radius of 9.5 px.</li>
<li>Generate 20 eroded images.</li>
<li>Evaluate the OR combination of the 20 eroded images.</li>
<li>Identify the connected components of the combined eroded images.</li>
<li>Use these connected components to seed the watershed process.</li>
</ol>
<p>The resulting script is very simple
(<a href="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/watershed-directional_erosion.py">download</a>).</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Watershed using directional erosions.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span> <span class="k">as</span> <span class="n">ndi</span>
<span class="kn">from</span> <span class="nn">skimage.feature</span> <span class="kn">import</span> <span class="n">peak_local_max</span>
<span class="kn">from</span> <span class="nn">skimage.io</span> <span class="kn">import</span> <span class="n">imread</span><span class="p">,</span> <span class="n">imsave</span><span class="p">,</span> <span class="n">imshow</span>
<span class="kn">from</span> <span class="nn">skimage.morphology</span> <span class="kn">import</span> <span class="n">watershed</span>

<span class="kn">from</span> <span class="nn">spheroid</span> <span class="kn">import</span> <span class="n">Spheroid</span>


<span class="k">def</span> <span class="nf">icosahedron</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="n">u</span><span class="p">,</span>  <span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">u</span><span class="p">,</span>  <span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span> <span class="p">[</span> <span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span> <span class="p">[</span> <span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="n">u</span><span class="p">],</span> <span class="p">[</span> <span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">u</span><span class="p">,</span>  <span class="n">v</span><span class="p">],</span>
                         <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">,</span>  <span class="n">v</span><span class="p">],</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">]],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">4</span><span class="p">],</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">9</span><span class="p">],</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>  <span class="mi">5</span><span class="p">],</span>
                      <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">8</span><span class="p">],</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span> <span class="p">[</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">6</span><span class="p">],</span> <span class="p">[</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span>
                      <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">8</span><span class="p">],</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="p">[</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>  <span class="mi">9</span><span class="p">],</span>
                      <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span> <span class="p">[</span> <span class="mi">5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">],</span> <span class="p">[</span> <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span> <span class="p">[</span> <span class="mi">7</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span>
                      <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">4</span><span class="p">],</span> <span class="p">[</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">5</span><span class="p">]],</span>
                     <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">faces</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">root</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;F:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;sebastien&#39;</span><span class="p">,</span> <span class="s1">&#39;experimental_data&#39;</span><span class="p">,</span> <span class="s1">&#39;navier&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;riz&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;rice-bin_4x4x4.hdf5&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing distance transform&#39;</span><span class="p">)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="s1">&#39;distance transform of `binary`&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selecting markers from directional erosion...&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">9.5</span>
        <span class="n">vertices</span>  <span class="o">=</span> <span class="n">icosahedron</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">eroded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
            <span class="n">spheroid</span> <span class="o">=</span> <span class="n">Spheroid</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">digitize</span><span class="p">()</span>
            <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eroded</span><span class="p">,</span>
                          <span class="n">ndi</span><span class="o">.</span><span class="n">binary_erosion</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span>
                                             <span class="n">structure</span><span class="o">=</span><span class="n">spheroid</span><span class="p">),</span>
                          <span class="n">out</span><span class="o">=</span><span class="n">eroded</span><span class="p">)</span>
        <span class="n">markers</span><span class="p">,</span> <span class="n">num_seeds</span> <span class="o">=</span>  <span class="n">ndi</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">eroded</span><span class="p">,</span>
                                        <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                                          <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">))</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">markers</span><span class="p">)</span>
        <span class="n">descr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;`binary` image was eroded with 20 spheroids &#39;</span><span class="o">+</span>
                 <span class="s1">&#39;(a=</span><span class="si">{}</span><span class="s1">, c=</span><span class="si">{}</span><span class="s1">) &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">+</span>
                 <span class="s1">&#39;using the vertices of a icosahedron as orientations. This&#39;</span><span class="o">+</span>
                 <span class="s1">&#39;image is the logical OR of all 20 eroded images.&#39;</span><span class="p">)</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    ... found </span><span class="si">{}</span><span class="s1"> seeds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_seeds</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing watershed transform&#39;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">watershed</span><span class="p">(</span><span class="o">-</span><span class="n">distance</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">binary</span><span class="p">)</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;watershed using `markers` and the opposite of `distance`.&#39;</span>
        <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">20150924</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">imsave</span><span class="p">(</span><span class="s1">&#39;distance.png&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">/</span><span class="n">distance</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">imsave</span><span class="p">(</span><span class="s1">&#39;makers-directional_erosion.png&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">markers</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>
    <span class="n">imsave</span><span class="p">(</span><span class="s1">&#39;watershed-directional_erosion.png&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>
</code></pre></div>

<p>It identifies 2362 seeds (instead of 2672 in the previous approach). The
resulting segmentation is shown in <a href="#fig05">Fig. 5</a>. It can be seen that we
almost got rid of over-segmentation.
<a name="fig05"></a>
<img alt="Directional erosion" class="figure" src="https://sbrisard.github.io/posts/20150930-Orientation_correlations_among_rice_grains-06/watershed-directional_erosion.png"></p>
<figcaption>Figure 5: The result of watershed segmentation using directional erosions of the map of the distance to the background as seeds. Very little over-segmentation is observed.</figcaption>
<h2>Conclusion</h2>
<p>In an image analysis pipeline, segmentation is notoriously the critical step of
the process.
<a href="https://en.wikipedia.org/wiki/Watershed_%28image_processing%29">Watershed</a> is a
very efficient technique, which requires careful seeding. For anisotropic
object, ad-hoc techniques have to be adopted. In the present blog, I showed how
some simple <a href="https://en.wikipedia.org/wiki/Mathematical_morphology">mathematical
morphology</a> operations
could be used to produce a satisfactory set of seeds. It should be noted however
that the reason why the proposed approach works so well is that rice grains are
nearly spheroidal. In other words, correctly seeding the watershed process is
highly problem dependent!</p>
<p>In the <a href="https://sbrisard.github.io/posts/20160219-orientation_correlations_among_rice_grains-07.html">next
instalment</a>
of this series, I will show how to analyse the shape and orientation of each
individual grain.</p>
  </div><!-- /.entry-content -->
</section>
<section>
  <h2>Comments</h2>
  <p>Please send your comments to <strong><code>sebastien [dot]
  brisard [at] univ [dash] eiffel [dot] fr</code></strong>. Your comments will be
  inserted below. Your email address will <em>not</em> appear.</p>
</section>
    <footer id="contentinfo" class="body">
      <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/" ><img alt="Creative Commons License" style="float:left;margin-right:5px;" src="https://i.creativecommons.org/l/by/4.0/88x31.png"/></a>Except where otherwise noted, content on this blog by <a href="https://cv.archives-ouvertes.fr/sbrisard">Sébastien Brisard</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>&nbsp;&mdash;&nbsp;This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>&nbsp;&mdash;&nbsp;This blog uses <a href="https://www.nordtheme.com/">Nord</a>, an arctic north-bluish color palette.</p>
    </footer>
  </body>
</html>